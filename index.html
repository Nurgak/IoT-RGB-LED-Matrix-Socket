<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IoT RGB LED Matrix Socket: Internet-of-Things RGB LED Matrix via Sockets</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IoT RGB LED Matrix Socket
   </div>
   <div id="projectbrief">Animation generation scripts written in Python</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Internet-of-Things RGB LED Matrix via Sockets </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a> <a href="#"><img src="https://img.shields.io/badge/docs-Doxygen-blue" alt="Documentation" class="inline"/></a> [<img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT" style="pointer-events: none;" class="inline"/>](LICENSE)</p>
<p ><img src="iot_rgb_led_matrix.jpg" alt="Internet-of-Things RGB LED Matrix" class="inline"/></p>
<p >This project in the continuation of the <a href="https://github.com/Nurgak/IoT-RGB-LED-Matrix">IoT RGB LED Matrix</a>. Socket communication is used, instead of Node-RED/MQTT, for a much faster update rate. The <a href="https://github.com/adafruit/RGB-matrix-Panel">Adafruit LED Matrix library</a> is used to take advantage of its incredibly optimized display update routine.</p>
<p >The ESP32 acts as the socket server, anything that is recieved from a client is directly read to the screen buffer. Therefore, the data packing must be done on the client side. Having the ESP32 as the server and the Python side the client allows to send data only when needed - when screen needs to be updated with new data.</p>
<p >Because of the way the data is compressed, only the 3 most significant bits are used for the display, allowing <em>only 8</em> shades per color channel, or 8^3=512 colors.</p>
<p >Code has been [extensively documented using Doxygen]().</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Example animations</h1>
<p >Having the client written in Python makes it straight forward to create animations using standard image processing tools, such as OpenCV, and link them to various APIs and display them quickly.</p>
<p >A list of examples have been prepared. To view any of the examples execute them using the example command in the list. The environment variable <code>$HOST_IP</code> represents the ESP32 IP address.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Animation   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Example   </th><th class="markdownTableHeadNone">Command    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Analog clock   </td><td class="markdownTableBodyNone">A face emulating an analog clock with hour, minute and second hands. Optionally, the <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">time zone</a> can be set, defaulting to GMT when not defined.   </td><td class="markdownTableBodyNone"><img src="AnalogClock.png" alt="" class="inline" title="Analog clock"/>  </td><td class="markdownTableBodyNone"><code>./main.py AnalogClock --timezone Asia/Tokyo display $HOST_IP</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Conway's Game of Life in Color   </td><td class="markdownTableBodyNone">[Cellular automaton](<a href="https://en.wikipedia.org/wiki/Conway's_Game_of_Life">https://en.wikipedia.org/wiki/Conway's_Game_of_Life</a>) iterative animation based on its state and some simple rules. A new pixel adopts the average color of its adjacent parents.   </td><td class="markdownTableBodyNone"><img src="GameOfLifeColor.gif" alt="" class="inline" title="Conway's Game of Life"/>  </td><td class="markdownTableBodyNone"><code>./main.py GameOfLifeColor display $HOST_IP</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Conway's Game of Life fast   </td><td class="markdownTableBodyNone">Same as the previous animation, but only in one color and optimized for speed.   </td><td class="markdownTableBodyNone"><img src="GameOfLifeFast.gif" alt="" class="inline" title="Conway's Game of Life"/>  </td><td class="markdownTableBodyNone"><code>./main.py GameOfLifeFast display $HOST_IP</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Digital data   </td><td class="markdownTableBodyNone">Display various data in digital format, using <a href="https://openweathermap.org/api">OpenWeatherMap API</a> and the <em>Small 5x3</em> font. The extra arguments are the <a href="https://openweathermap.org/api">OWM API key</a>, the <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">timezone</a> and the <a href="https://openweathermap.org/current#name">city</a> information for the temperature, humidity and air pollution data.   </td><td class="markdownTableBodyNone"><img src="DigitalData.png" alt="" class="inline" title="Digital data"/>  </td><td class="markdownTableBodyNone"><code>./main.py DigitalData --key $OWM_API_KEY -t Asia/Tokyo -c Tokyo display $HOST_IP</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Fire   </td><td class="markdownTableBodyNone">A simplistic fire animation.   </td><td class="markdownTableBodyNone"><img src="Fire.gif" alt="" class="inline" title="Fire"/>  </td><td class="markdownTableBodyNone"><code>./main.py Fire display $HOST_IP</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">English word clock   </td><td class="markdownTableBodyNone">Time, but written in English. Using the <em>Small 5x3</em> font.   </td><td class="markdownTableBodyNone"><img src="WordClockEnglish.png" alt="" class="inline" title="English word clock"/>  </td><td class="markdownTableBodyNone"><code>./main.py WordClockEnglish -t Asia/Tokyo display $HOST_IP</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Japanese word clock   </td><td class="markdownTableBodyNone">Time, but written in Japanese Kanji using the <em>Misaki Font</em>.   </td><td class="markdownTableBodyNone"><img src="WordClockJapanese.png" alt="" class="inline" title="Japanese word clock"/>  </td><td class="markdownTableBodyNone"><code>./main.py WordClockJapanese -t Asia/Tokyo display $HOST_IP</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Maze generator   </td><td class="markdownTableBodyNone">A maze generator based on the <a href="https://weblog.jamisbuck.org/2011/1/27/maze-generation-growing-tree-elgorithm">Growing Tree algorithm</a>, implemented as a recursive function.   </td><td class="markdownTableBodyNone"><img src="MazeGrowingTree.gif" alt="" class="inline" title="Maze generator"/>  </td><td class="markdownTableBodyNone"><code>./main.py MazeGrowingTree display $HOST_IP</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">QR code   </td><td class="markdownTableBodyNone">Text converted to QR code.   </td><td class="markdownTableBodyNone"><img src="QRCode.png" alt="" class="inline" title="QR code"/>  </td><td class="markdownTableBodyNone"><code>./main.py QRCode --text "test" display $HOST_IP</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Water   </td><td class="markdownTableBodyNone">A water drop animation.   </td><td class="markdownTableBodyNone"><img src="Water.gif" alt="" class="inline" title="Water"/>  </td><td class="markdownTableBodyNone"><code>./main.py Water display $HOST_IP</code>   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md2"></a>
Hardware</h1>
<p >An ESP32 breakout board was used in this project with a <a href="https://hackaday.io/project/28945-iot-rgb-led-matrix-controller-esp32">custom adapter PCB</a>. Although the adapter is not necessary as the ESP32 breakout can be connected to the RGB LED matrix with some cables just as well.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Pinout</h2>
<p >The pin assignment is not strict and every pin can be reconfigured to another one, but it is recommended to follow the pinout below so it would work with the unmodified code.</p>
<table class="doxtable">
<tr>
<th>Pin </th><th>GPIO </th><th>Reference  </th></tr>
<tr>
<td>OE </td><td>13 </td><td rowspan="13"><img src="esp32_pinout.png" alt="" class="inline"/>  </td></tr>
<tr>
<td>CLK </td><td>14  </td></tr>
<tr>
<td>LAT </td><td>15  </td></tr>
<tr>
<td>CH_A </td><td>26  </td></tr>
<tr>
<td>CH_B </td><td>4  </td></tr>
<tr>
<td>CH_C </td><td>27  </td></tr>
<tr>
<td>CH_D </td><td>2  </td></tr>
<tr>
<td>R1 </td><td>5  </td></tr>
<tr>
<td>G1 </td><td>17  </td></tr>
<tr>
<td>BL1 </td><td>18  </td></tr>
<tr>
<td>R2 </td><td>19  </td></tr>
<tr>
<td>G2 </td><td>16  </td></tr>
<tr>
<td>BL2 </td><td>25  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md4"></a>
Installation</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
Dependencies</h2>
<p >The ESP32 is programmed via Arduino IDE and needs the following libraries</p>
<ul>
<li><a href="https://github.com/adafruit/RGB-matrix-Panel">https://github.com/adafruit/RGB-matrix-Panel</a></li>
<li><a href="https://github.com/adafruit/Adafruit-GFX-Library">https://github.com/adafruit/Adafruit-GFX-Library</a></li>
<li><a href="https://github.com/adafruit/Adafruit_BusIO">https://github.com/adafruit/Adafruit_BusIO</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md6"></a>
Firmware</h2>
<p >The ESP32 needs to have its firmware uploaded before it can recieve the data stream from the client. The client must be on the same network and be provided with the IP of the ESP32. The IP is displayed on the LED matrix when it starts up.</p>
<p >The WiFi credentials need be provided in the <code>config.h</code> file.</p>
<p ><img src="ip.jpg" alt="" class="inline" title="IoT RGB LED Matrix showing its IP address upon successful connection to the local network."/></p>
<h2><a class="anchor" id="autotoc_md7"></a>
Fonts</h2>
<p >The fonts used in this project are property of their respective creators. As they are free to be redistributed they are also bundeled with this project, but they have their own licenses distinct from this project.</p>
<ul>
<li><a href="https://fontsup.com/font/small-5x3-regular.html">Small 5x3 Regular</a> by <a href="https://fontsup.com/designer/soxhead2000.html">Soxhead2000</a> (<a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA</a>)</li>
<li><a href="https://littlelimit.net/misaki.htm">Misaki Font</a> by <a href="https://littlelimit.net/about.htm">門真 なむ</a> (<a href="https://littlelimit.net/font.htm#license">free software</a>)</li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
Main</h2>
<p >The <code>main.py</code> file imports all the example animations and allows to configure and launch them. This is the beginning of all execution.</p>
<p >The <code>-h</code> flag will show how to use it. For example </p><pre class="fragment">./main.py -h
</pre><p> Some animations have extra arguments, such as the time zone for the clocks. See the usage for specific animations in the examples section.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Display</h3>
<p >To display the animation on an RGB LED Matrix add the <code>display</code> suffix with the IP of the ESP32. </p><pre class="fragment">./main.py &lt;Animation name&gt; display 192.168.3.15
</pre> <h3><a class="anchor" id="autotoc_md11"></a>
Saving</h3>
<p >To save an animation to a file add the <code>save</code> suffix with the number of frames to save. One frame will result in a static <code>png</code>, more will be saved as a <code>gif</code>. The file name will be <code>&lt;Animation name&gt;.png/gif</code>. </p><pre class="fragment">./main.py &lt;Animation name&gt; save 1
</pre> <h2><a class="anchor" id="autotoc_md12"></a>
Docker</h2>
<p >An effective way to run the client side is to use Docker. This is a prepared and tested environment where all the dependencies are already installed.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
Build</h3>
<pre class="fragment">docker build -t iot_rgb_matrix_panel_client .
</pre> <h3><a class="anchor" id="autotoc_md14"></a>
Run</h3>
<pre class="fragment">docker run -it --rm -v "$(pwd):/root/ws" \
    -p 7777:7777 \
    -e HOST_IP=192.168.3.15 \
    -e PORT=7777 \
    -e ANIMATION=AnalogClock \
    -e WIDTH=32 \
    -e HEIGHT=32 \
    iot_rgb_matrix_panel_client
</pre> <h1><a class="anchor" id="autotoc_md15"></a>
Notes</h1>
<ul>
<li>This project has only been tested with a 32x32 RGB LED matrix panel.</li>
<li>The recommended panel is an official <a href="https://www.adafruit.com/product/607">Adafruit one</a>. Cheaper can be had, but experience has shown major luminosity degradation and burn-in issues with those.</li>
</ul>
<h1><a class="anchor" id="autotoc_md16"></a>
License</h1>
<p >This project is published under the [MIT license](LICENSE). </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
